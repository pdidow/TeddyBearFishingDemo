@echo off
setlocal enabledelayedexpansion

:: === CONFIGURATION ===
set REPO_PATH=C:\Users\peter\Downloads\TeddyBearFishingDemo
set REMOTE_URL=https://github.com/pdidow/TeddyBearFishingDemo.git
set BRANCH_NAME=main
set SIZE_LIMIT=52428800  :: 50 MB (in bytes)

echo =======================================================
echo Resetting and uploading %REPO_PATH% to GitHub with LFS
echo =======================================================
echo.

cd /d "%REPO_PATH%" || (echo Folder not found! && exit /b)

:: 1. Remove old Git data
echo Removing old .git folder...
rmdir /s /q .git 2>nul

:: 2. Initialize repo
echo Initializing new Git repository...
git init
git lfs install

:: 3. Track common large file types
echo Setting up LFS tracking rules...
git lfs track "*.xnb"
git lfs track "*.png"
git lfs track "*.jpg"
git lfs track "*.jpeg"
git lfs track "*.tga"
git lfs track "*.bmp"
git lfs track "*.psd"
git lfs track "*.fbx"
git lfs track "*.wav"
git lfs track "*.mp3"
git lfs track "*.ogg"
git lfs track "*.blend"
git add .gitattributes

:: 4. Auto-track any files larger than SIZE_LIMIT (50MB)
echo Searching for files larger than 50MB to add to LFS...
for /f "usebackq delims=" %%A in (`forfiles /s /m *.* /c "cmd /c if @fsize gtr %SIZE_LIMIT% echo @relpath"`) do (
    set FILE=%%~A
    echo Tracking large file: !FILE!
    git lfs track "!FILE!"
)

:: 5. Add and commit all files
echo Staging and committing files...
git add .
git commit -m "Full upload of TeddyBearFishingDemo with Git LFS auto-tracking"

:: 6. Set branch and remote
echo Setting branch and remote...
git branch -M %BRANCH_NAME%
git remote remove origin 2>nul
git remote add origin %REMOTE_URL%

:: 7. Push (force overwrite to make clean)
echo Pushing to GitHub (force overwrite)...
git push -u origin %BRANCH_NAME% --force

echo.
echo Done! Your repository should now be fully uploaded with LFS tracking.
echo =======================================================
pause
